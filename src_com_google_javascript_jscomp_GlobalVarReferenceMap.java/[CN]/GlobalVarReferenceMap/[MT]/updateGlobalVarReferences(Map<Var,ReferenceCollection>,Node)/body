{
  if (refMap == null || root.getType() != Token.SCRIPT) {
    resetGlobalVarReferences(refMapPatch);
    return;
  }
  String sourceName=NodeUtil.getSourceName(root);
  Preconditions.checkNotNull(sourceName);
  removeScriptReferences(sourceName);
  for (  Entry<Var,ReferenceCollection> entry : refMapPatch.entrySet()) {
    Var var=entry.getKey();
    if (var.isGlobal()) {
      replaceReferences(var.getName(),sourceName,entry.getValue());
    }
  }
}
