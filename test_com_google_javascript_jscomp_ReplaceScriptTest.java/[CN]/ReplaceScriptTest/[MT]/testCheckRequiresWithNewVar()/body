{
  CompilerOptions options=getOptions();
  options.setWarningLevel(DiagnosticGroups.MISSING_REQUIRE,CheckLevel.ERROR);
  options.setClosurePass(true);
  String src="";
  String modifiedSrc=src + "\n(function() { var a = new ns.Bar(); })();";
  Result result=runReplaceScript(options,ImmutableList.of(src),0,0,modifiedSrc,0,false).getResult();
  assertFalse(result.success);
  assertThat(result.errors).hasLength(1);
  assertErrorType(result.errors[0],CheckRequiresForConstructors.MISSING_REQUIRE_WARNING,2);
}
