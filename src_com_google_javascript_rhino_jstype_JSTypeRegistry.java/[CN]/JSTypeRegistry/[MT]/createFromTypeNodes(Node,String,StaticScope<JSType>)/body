{
switch (n.getType()) {
case Token.LC:
    return createRecordTypeFromNodes(n.getFirstChild(),sourceName,scope);
case Token.BANG:
  return createFromTypeNodes(n.getFirstChild(),sourceName,scope).restrictByNotNullOrUndefined();
case Token.QMARK:
Node firstChild=n.getFirstChild();
if (firstChild == null) {
return getNativeType(UNKNOWN_TYPE);
}
return createDefaultObjectUnion(createFromTypeNodes(firstChild,sourceName,scope));
case Token.EQUALS:
return createOptionalType(createFromTypeNodes(n.getFirstChild(),sourceName,scope));
case Token.ELLIPSIS:
return createOptionalType(createFromTypeNodes(n.getFirstChild(),sourceName,scope));
case Token.STAR:
return getNativeType(ALL_TYPE);
case Token.LB:
return getNativeType(ARRAY_TYPE);
case Token.PIPE:
UnionTypeBuilder builder=new UnionTypeBuilder(this);
for (Node child=n.getFirstChild(); child != null; child=child.getNext()) {
builder.addAlternate(createFromTypeNodes(child,sourceName,scope));
}
return builder.build();
case Token.EMPTY:
return getNativeType(UNKNOWN_TYPE);
case Token.VOID:
return getNativeType(VOID_TYPE);
case Token.STRING:
JSType namedType=getType(scope,n.getString(),sourceName,n.getLineno(),n.getCharno());
if ((namedType instanceof ObjectType) && !(enumTypeNames.contains(n.getString()))) {
Node typeList=n.getFirstChild();
if (typeList != null && ("Array".equals(n.getString()) || "Object".equals(n.getString()))) {
JSType parameterType=createFromTypeNodes(typeList.getLastChild(),sourceName,scope);
namedType=new ParameterizedType(this,(ObjectType)namedType,parameterType);
if (typeList.hasMoreThanOneChild()) {
JSType indexType=createFromTypeNodes(typeList.getFirstChild(),sourceName,scope);
namedType=new IndexedType(this,(ObjectType)namedType,indexType);
}
}
return createDefaultObjectUnion(namedType);
}
 else {
return namedType;
}
case Token.FUNCTION:
ObjectType thisType=null;
Node current=n.getFirstChild();
if (current.getType() == Token.THIS) {
Node thisNode=current.getFirstChild();
thisType=ObjectType.cast(createFromTypeNodes(thisNode,sourceName,scope).restrictByNotNullOrUndefined());
if (thisType == null) {
reporter.warning(ScriptRuntime.getMessage0("msg.jsdoc.function.thisnotobject"),sourceName,thisNode.getLineno(),"",thisNode.getCharno());
}
current=current.getNext();
}
FunctionParamBuilder paramBuilder=new FunctionParamBuilder(this);
if (current.getType() == Token.LP) {
Node args=current.getFirstChild();
for (Node arg=current.getFirstChild(); arg != null; arg=arg.getNext()) {
if (arg.getType() == Token.ELLIPSIS) {
if (arg.getChildCount() == 0) {
paramBuilder.addVarArgs(getNativeType(UNKNOWN_TYPE));
}
 else {
paramBuilder.addVarArgs(createFromTypeNodes(arg.getFirstChild(),sourceName,scope));
}
}
 else {
JSType type=createFromTypeNodes(arg,sourceName,scope);
if (arg.getType() == Token.EQUALS) {
boolean addSuccess=paramBuilder.addOptionalParams(type);
if (!addSuccess) {
reporter.warning(ScriptRuntime.getMessage0("msg.jsdoc.function.varargs"),sourceName,arg.getLineno(),"",arg.getCharno());
}
}
 else {
paramBuilder.addRequiredParams(type);
}
}
}
current=current.getNext();
}
JSType returnType=createFromTypeNodes(current,sourceName,scope);
return new FunctionType(this,null,null,paramBuilder.build(),returnType,thisType,null);
}
throw new IllegalStateException("Unexpected node in type expression: " + n.toString());
}
