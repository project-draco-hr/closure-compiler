{
  if (!(NodeUtil.isName(n) || NodeUtil.isGet(n) && !NodeUtil.isGetProp(parent))) {
    return;
  }
  NameInformation nameInfo=createNameInformation(t,n,parent);
  if (nameInfo == null) {
    return;
  }
  if (nameInfo.onlyAffectsClassDef) {
    recordReference(nameInfo.name,nameInfo.superclass,RefType.INHERITANCE);
    String nodeName=n.getQualifiedName();
    if (nodeName != null) {
      recordReference(nameInfo.name,nodeName,RefType.REGULAR);
    }
    return;
  }
  if (parent.getType() == Token.INSTANCEOF && parent.getLastChild() == n) {
    JsName checkedClass=getName(nameInfo.name,true);
    refNodes.add(new InstanceOfCheckNode(checkedClass,n,parent,parent.getParent()));
    return;
  }
  NameInformation referring=getDependencyScope(n);
  String referringName="";
  if (referring != null) {
    referringName=referring.isPrototype ? referring.prototypeClass : referring.name;
  }
  String name=nameInfo.name;
  if (nameInfo.isExternallyReferenceable) {
    recordReference(WINDOW,name,RefType.REGULAR);
    return;
  }
  if (NodeUtil.isLhs(n,parent)) {
    if (referring != null) {
      recordReference(referringName,name,RefType.REGULAR);
    }
    return;
  }
  if (nodesToKeep.contains(n)) {
    NameInformation functionScope=getEnclosingFunctionDependencyScope(t);
    if (functionScope != null) {
      recordReference(functionScope.name,name,RefType.REGULAR);
    }
 else {
      recordReference(WINDOW,name,RefType.REGULAR);
    }
  }
 else   if (referring != null) {
    if ((parent.getType() == Token.NAME || parent.getType() == Token.ASSIGN) && scopes.get(parent) == referring) {
      recordAlias(referringName,name);
    }
 else {
      RefType depType=referring.onlyAffectsClassDef ? RefType.INHERITANCE : RefType.REGULAR;
      recordReference(referringName,name,depType);
    }
  }
 else {
    for (    Node ancestor : n.getAncestors()) {
      if (NodeUtil.isAssignmentOp(ancestor) || NodeUtil.isFunction(ancestor)) {
        recordReference(WINDOW,name,RefType.REGULAR);
        break;
      }
    }
  }
}
