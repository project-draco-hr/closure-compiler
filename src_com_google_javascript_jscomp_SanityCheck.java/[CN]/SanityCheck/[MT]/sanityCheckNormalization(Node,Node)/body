{
  CodeChangeHandler.RecentChange handler=new CodeChangeHandler.RecentChange();
  compiler.addChangeHandler(handler);
  new PrepareAst(compiler,true).process(null,root);
  Preconditions.checkState(!handler.hasCodeChanged(),"This should never fire, NodeTypeNormalizer should assert first.");
  if (compiler.isNormalized()) {
    (new Normalize(compiler,true)).process(externs,root);
    Preconditions.checkState(!handler.hasCodeChanged(),"This should never fire, Normalize should assert first.");
    boolean checkUserDeclarations=true;
    CompilerPass pass=new Normalize.VerifyConstants(compiler,checkUserDeclarations);
    pass.process(externs,root);
  }
  compiler.removeChangeHandler(handler);
}
