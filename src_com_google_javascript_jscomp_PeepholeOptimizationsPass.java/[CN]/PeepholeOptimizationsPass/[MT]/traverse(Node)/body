{
  if (!shouldVisit(node)) {
    return;
  }
  int visits=0;
  do {
    for (Node c=node.getFirstChild(); c != null; c=c.getNext()) {
      traverse(c);
    }
    visit(node);
    visits++;
    Preconditions.checkState(visits < 10000,"too many interations");
  }
 while (shouldRetraverse(node));
  exitNode(node);
}
