{
  if (subtree.getType() != Token.SCRIPT && subtree.getType() != Token.BLOCK) {
    return subtree;
  }
  boolean codeChanged=false;
  for (Node child=subtree.getFirstChild(); child != null; child=child.getNext()) {
    if (child.getType() != Token.VAR && !NodeUtil.isExprAssign(child)) {
      continue;
    }
    if (!isPropertyAssignmentToName(child.getNext())) {
      continue;
    }
    Preconditions.checkState(child.hasOneChild());
    Node name=getName(child);
    if (name.getType() != Token.NAME) {
      continue;
    }
    Node value=getValue(child);
    if (value == null || !isInterestingValue(value)) {
      continue;
    }
    Node propertyCandidate;
    while ((propertyCandidate=child.getNext()) != null) {
      if (!collectProperty(propertyCandidate,name.getString(),value)) {
        break;
      }
      codeChanged=true;
    }
  }
  if (codeChanged) {
    reportCodeChange();
  }
  return subtree;
}
