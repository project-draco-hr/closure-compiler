{
  Compiler compiler=createCompiler();
  CompilerOptions options=getOptions();
  compiler.init(new JSSourceFile[]{},new JSSourceFile[]{JSSourceFile.fromCode("testcode",js)},options);
  Node root=compiler.parseInputs();
  assertTrue("Unexpected parse error(s): " + Joiner.on("\n").join(compiler.getErrors()) + "\nEXPR: "+ js,root != null);
  Node externsRoot=root.getFirstChild();
  Node mainRoot=externsRoot.getNext();
  if (runProcessor) {
    getProcessor(compiler).process(externsRoot,mainRoot);
  }
  return compiler.toSource(mainRoot);
}
