{
  blocksWithDeclarations.clear();
  boolean isDeclaredInScope=false;
  boolean isUnhoistedNamedFunction=false;
  Reference hoistedFn=null;
  for (  Reference reference : references) {
    if (reference.isHoistedFunction()) {
      blocksWithDeclarations.add(reference.getBasicBlock());
      isDeclaredInScope=true;
      hoistedFn=reference;
      break;
    }
 else     if (NodeUtil.isFunctionDeclaration(reference.getNode().getParent())) {
      isUnhoistedNamedFunction=true;
    }
  }
  for (  Reference reference : references) {
    if (reference == hoistedFn) {
      continue;
    }
    BasicBlock basicBlock=reference.getBasicBlock();
    boolean isDeclaration=reference.isDeclaration();
    boolean allowDupe=SyntacticScopeCreator.hasDuplicateDeclarationSuppression(reference.getNode(),v);
    if (isDeclaration && !allowDupe) {
      for (      BasicBlock declaredBlock : blocksWithDeclarations) {
        if (declaredBlock.provablyExecutesBefore(basicBlock)) {
          String filename=NodeUtil.getSourceName(reference.getNode());
          compiler.report(JSError.make(filename,reference.getNode(),checkLevel,REDECLARED_VARIABLE,v.name));
          break;
        }
      }
    }
    if (isUnhoistedNamedFunction && !isDeclaration && isDeclaredInScope) {
      for (      BasicBlock declaredBlock : blocksWithDeclarations) {
        if (!declaredBlock.provablyExecutesBefore(basicBlock)) {
          String filename=NodeUtil.getSourceName(reference.getNode());
          compiler.report(JSError.make(filename,reference.getNode(),AMBIGUOUS_FUNCTION_DECL,v.name));
          break;
        }
      }
    }
    if (!isDeclaration && !isDeclaredInScope) {
      if (!reference.getNode().isFromExterns()) {
        Node grandparent=reference.getGrandparent();
        if (grandparent.getType() == Token.NAME && grandparent.getString() == v.name) {
          continue;
        }
        if (reference.getScope() == v.scope) {
          String filename=NodeUtil.getSourceName(reference.getNode());
          compiler.report(JSError.make(filename,reference.getNode(),checkLevel,UNDECLARED_REFERENCE,v.name));
        }
      }
    }
    if (isDeclaration) {
      blocksWithDeclarations.add(basicBlock);
      isDeclaredInScope=true;
    }
  }
}
