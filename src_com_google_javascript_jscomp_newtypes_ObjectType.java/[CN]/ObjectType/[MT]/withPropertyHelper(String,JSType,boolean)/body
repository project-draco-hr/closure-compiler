{
  Map<String,Property> newProps=Maps.newHashMap(this.props);
  if (TypeUtils.isIdentifier(qname)) {
    if (type == null) {
      newProps.remove(qname);
    }
 else {
      newProps.put(qname,new Property(type,isDeclared ? type : null,false));
    }
  }
 else {
    String objName=qname.substring(0,qname.indexOf('.'));
    String innerProps=qname.substring(qname.indexOf('.') + 1);
    if (!this.props.containsKey(objName)) {
      Preconditions.checkState(mayHaveProp(objName));
      newProps.put(objName,getLeftmostProp(objName));
    }
    Property objProp=newProps.get(objName);
    newProps.put(objName,new Property(objProp.getType().withProperty(innerProps,type),objProp.getDeclaredType(),objProp.isOptional()));
  }
  return ObjectType.makeObjectType(nominalType,newProps,fn,isLoose);
}
