{
  String[] argStrings=args.toArray(new String[]{});
  CommandLineRunner runner=new CommandLineRunner(argStrings);
  Compiler compiler=runner.createCompiler();
  lastCompiler=compiler;
  CompilerOptions options=runner.createOptions();
  try {
    runner.setRunOptions(options);
  }
 catch (  AbstractCommandLineRunner.FlagUsageException e) {
    fail("Unexpected exception " + e);
  }
catch (  IOException e) {
    assert(false);
  }
  if (useModules) {
    compiler.compile(externs,CompilerTestCase.createModuleChain(original),options);
  }
 else {
    JSSourceFile[] inputs=new JSSourceFile[original.length];
    for (int i=0; i < original.length; i++) {
      inputs[i]=JSSourceFile.fromCode("input" + i,original[i]);
    }
    compiler.compile(externs,inputs,options);
  }
  return compiler;
}
