{
  Preconditions.checkArgument(scriptNodeCount == 1,"ProcessCommonJSModules supports only one invocation per " + "CompilerInput / script node");
  String name=loader.getLoadAddress(t.getInput());
  if (name.endsWith(INDEX_ENDING)) {
    name=name.substring(0,name.length() - INDEX_ENDING.length());
  }
  String moduleName=toModuleName(name);
  NodeTraversal.traverse(compiler,script,new SuffixVarsCallback(moduleName));
  processExports(script,moduleName);
  moduleExportRefs.clear();
  exportRefs.clear();
  if (reportDependencies) {
    CompilerInput ci=t.getInput();
    ci.addProvide(moduleName);
    JSModule m=new JSModule(moduleName);
    m.addAndOverrideModule(ci);
    module=m;
  }
  script.addChildToFront(IR.exprResult(IR.call(IR.getprop(IR.name("goog"),IR.string("provide")),IR.string(moduleName))).copyInformationFromForTree(script));
  compiler.reportCodeChange();
}
