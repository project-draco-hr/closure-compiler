{
  if (includePrivate || includeProtected) {
    try {
      List<Field> fieldsList=new ArrayList<Field>();
      Class<?> currentClass=cl;
      while (currentClass != null) {
        Field[] declared=currentClass.getDeclaredFields();
        for (        Field field : declared) {
          int mod=field.getModifiers();
          if (includePrivate || isPublic(mod) || isProtected(mod)) {
            if (!field.isAccessible())             field.setAccessible(true);
            fieldsList.add(field);
          }
        }
        currentClass=currentClass.getSuperclass();
      }
      return fieldsList.toArray(new Field[fieldsList.size()]);
    }
 catch (    SecurityException e) {
    }
  }
  return cl.getFields();
}
