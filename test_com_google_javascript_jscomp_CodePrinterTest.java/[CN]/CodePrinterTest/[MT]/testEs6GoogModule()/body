{
  String code="" + "goog.module('foo.bar');\n" + "const STR = '3';\n"+ "function fn() {\n"+ "  alert(STR);\n"+ "}\n"+ "exports.fn = fn;\n";
  String expectedCode="" + "var module$exports$foo$bar = {};\n" + "const STR = '3';\n"+ "function fn() {\n"+ "  alert(STR);\n"+ "}\n"+ "exports.fn = fn;\n";
  CompilerOptions compilerOptions=new CompilerOptions();
  compilerOptions.setCheckSymbols(true);
  compilerOptions.setCheckTypes(true);
  compilerOptions.setClosurePass(true);
  compilerOptions.setIdeMode(true);
  compilerOptions.setPreserveGoogProvidesAndRequires(true);
  Compiler compiler=new Compiler();
  compiler.disableThreads();
  compiler.compile(ImmutableList.<SourceFile>of(),ImmutableList.of(SourceFile.fromCode("test",code)),compilerOptions);
  Node node=compiler.getRoot().getLastChild().getFirstChild();
  CompilerOptions codePrinterOptions=new CompilerOptions();
  codePrinterOptions.setPreferSingleQuotes(true);
  codePrinterOptions.setLineLengthThreshold(80);
  codePrinterOptions.setUseOriginalNamesInOutput(true);
  assertEquals(expectedCode,new CodePrinter.Builder(node).setCompilerOptions(codePrinterOptions).setPrettyPrint(true).setLineBreak(true).build());
}
