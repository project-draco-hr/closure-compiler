{
  Compiler compiler=lastCompiler=new Compiler();
  compiler.disableThreads();
  CompilerOptions options=new CompilerOptions();
  options.checkTypes=true;
  Node templateNode=compiler.parse(SourceFile.fromCode("template",template));
  compiler.compile(ImmutableList.of(SourceFile.fromCode("externs",CompilerTestCase.DEFAULT_EXTERNS + externs)),ImmutableList.of(SourceFile.fromCode("test","{" + code + "}")),options);
  Node root=compiler.getRoot();
  return new TestNodePair(templateNode,root.getLastChild());
}
