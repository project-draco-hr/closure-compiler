{
  boolean createSourceMap=(sourceMap != null);
  CodeConsumer cp=outputFormat == Format.COMPACT ? new CompactCodePrinter(lineBreak,lineLengthThreshold,createSourceMap) : new PrettyCodePrinter(lineLengthThreshold,createSourceMap);
  CodeGenerator cg=outputFormat == Format.TYPED ? new TypedCodeGenerator(cp,outputCharset) : new CodeGenerator(cp,outputCharset,validation);
  cg.add(root);
  String code=((HasGetCode)cp).getCode();
  if (createSourceMap) {
    cp.generateSourceMap(sourceMap);
  }
  return code;
}
