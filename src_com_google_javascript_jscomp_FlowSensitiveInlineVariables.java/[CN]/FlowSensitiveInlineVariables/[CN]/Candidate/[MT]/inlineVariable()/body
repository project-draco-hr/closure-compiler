{
  Node defParent=def.getParent();
  Node useParent=use.getParent();
  if (NodeUtil.isAssign(def)) {
    Node rhs=def.getLastChild();
    rhs.detachFromParent();
    Preconditions.checkState(NodeUtil.isExpressionNode(defParent));
    while (defParent.getParent().getType() == Token.LABEL) {
      defParent=defParent.getParent();
    }
    defParent.detachFromParent();
    useParent.replaceChild(use,rhs);
  }
 else   if (NodeUtil.isVar(defParent)) {
    Node rhs=def.getLastChild();
    def.removeChild(rhs);
    useParent.replaceChild(use,rhs);
  }
 else {
    Preconditions.checkState(false,"No other definitions can be inlined.");
  }
  compiler.reportCodeChange();
}
