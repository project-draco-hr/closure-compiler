{
  Node addingRoot=null;
  Node ancestor=n;
  while (null != (ancestor=ancestor.getParent())) {
    Token.Kind type=ancestor.getType();
    if (type == Token.SCRIPT) {
      addingRoot=ancestor;
      break;
    }
 else     if (type == Token.FUNCTION) {
      addingRoot=ancestor.getLastChild();
      break;
    }
  }
  Preconditions.checkState(addingRoot.isBlock() || addingRoot.isScript());
  Preconditions.checkState(addingRoot.getFirstChild() == null || !addingRoot.getFirstChild().isScript());
  return addingRoot;
}
