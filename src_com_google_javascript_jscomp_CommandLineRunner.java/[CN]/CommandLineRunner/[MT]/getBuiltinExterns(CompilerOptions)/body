{
  InputStream input=CommandLineRunner.class.getResourceAsStream("/externs.zip");
  if (input == null) {
    input=CommandLineRunner.class.getResourceAsStream("externs.zip");
  }
  Preconditions.checkNotNull(input);
  ZipInputStream zip=new ZipInputStream(input);
  final String envPrefix=options.getEnvironment().toString().toLowerCase() + "/";
  Map<String,SourceFile> externsMap=new HashMap<>();
  for (ZipEntry entry=null; (entry=zip.getNextEntry()) != null; ) {
    if (entry.getName().indexOf("/") < 0 || (entry.getName().indexOf(envPrefix) == 0 && entry.getName().length() > envPrefix.length())) {
      BufferedInputStream entryStream=new BufferedInputStream(ByteStreams.limit(zip,entry.getSize()));
      externsMap.put(entry.getName(),SourceFile.fromInputStream("externs.zip//" + entry.getName(),entryStream,UTF_8));
    }
  }
  List<SourceFile> externs=new ArrayList<>();
  for (  String key : BUILTIN_LANG_EXTERNS) {
    Preconditions.checkState(externsMap.containsKey(key),"Externs zip must contain " + key + ".");
    externs.add(externsMap.remove(key));
  }
  for (  String key : BUILTIN_EXTERN_DEP_ORDER) {
    if (key.indexOf(envPrefix) < 0) {
      continue;
    }
    Preconditions.checkState(externsMap.containsKey(key),"Externs zip must contain " + key + " when environment is "+ options.getEnvironment().toString());
    externs.add(externsMap.remove(key));
  }
  externs.addAll(externsMap.values());
  return externs;
}
