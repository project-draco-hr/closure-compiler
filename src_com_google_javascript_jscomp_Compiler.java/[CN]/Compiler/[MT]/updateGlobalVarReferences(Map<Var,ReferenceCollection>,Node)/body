{
  Preconditions.checkState(collectionRoot.getType() == Token.SCRIPT || collectionRoot.getType() == Token.BLOCK);
  if (globalRefMap == null) {
    globalRefMap=new GlobalVarReferenceMap(getInputsInOrder(),getExternsInOrder());
  }
  globalRefMap.updateGlobalVarReferences(refMapPatch,collectionRoot);
}
