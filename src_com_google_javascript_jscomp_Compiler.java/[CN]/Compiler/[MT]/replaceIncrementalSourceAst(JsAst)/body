{
  String sourceName=ast.getSourceFile().getName();
  CompilerInput oldInput=Preconditions.checkNotNull(getInput(sourceName),"No input to replace: " + sourceName);
  Node newRoot=ast.getAstRoot(this);
  if (newRoot == null) {
    return false;
  }
  Node oldRoot=oldInput.getAstRoot(this);
  if (oldRoot != null) {
    oldRoot.getParent().replaceChild(oldRoot,newRoot);
  }
 else {
    getRoot().getLastChild().addChildToBack(newRoot);
  }
  CompilerInput newInput=new CompilerInput(ast);
  inputsByName.put(sourceName,newInput);
  JSModule module=oldInput.getModule();
  if (module != null) {
    module.addAfter(newInput,oldInput);
    module.remove(oldInput);
  }
  return true;
}
