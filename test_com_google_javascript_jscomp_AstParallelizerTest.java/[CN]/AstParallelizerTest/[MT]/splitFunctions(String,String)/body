{
  Compiler compiler=new Compiler();
  Node original=compiler.parseTestCode(input);
  Node root=original.cloneTree();
  AstParallelizer parallelizer=AstParallelizer.createNewFunctionLevelAstParallelizer(root,true);
  List<Node> forest=parallelizer.split();
  assertThat(forest).hasSize(output.length);
  int i=0;
  for (  Node n : forest) {
    Node tree=compiler.parseTestCode(output[i++]);
    assertEquals(compiler.toSource(tree),compiler.toSource(n));
  }
  parallelizer.join();
  assertTrue(original.isEquivalentTo(root));
}
