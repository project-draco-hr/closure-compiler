{
  int opType=n.getType();
  Preconditions.checkState((NodeUtil.isAssociative(opType) && NodeUtil.isCommutative(opType)) || n.isAdd());
  Preconditions.checkState(n.getType() != Token.ADD || !NodeUtil.mayBeString(n));
  Double rightValObj=NodeUtil.getNumberValue(right);
  if (rightValObj != null && left.getType() == opType) {
    Preconditions.checkState(left.getChildCount() == 2);
    Node ll=left.getFirstChild();
    Node lr=ll.getNext();
    Node valueToCombine=ll;
    Node replacement=performArithmeticOp(opType,valueToCombine,right);
    if (replacement == null) {
      valueToCombine=lr;
      replacement=performArithmeticOp(opType,valueToCombine,right);
    }
    if (replacement != null) {
      left.removeChild(valueToCombine);
      n.replaceChild(left,left.removeFirstChild());
      replacement.copyInformationFromForTree(right);
      n.replaceChild(right,replacement);
      reportCodeChange();
    }
  }
  return n;
}
