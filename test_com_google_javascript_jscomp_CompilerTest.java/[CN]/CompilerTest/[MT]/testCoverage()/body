{
  final String original="var name = 1;\n" + "function f() {\n" + " var name2 = 2;\n"+ "}\n"+ "window['f'] = f;\n";
  final String expected="var JSCompiler_lcov_fileNames=JSCompiler_lcov_fileNames||[];" + "var JSCompiler_lcov_instrumentedLines=" + "JSCompiler_lcov_instrumentedLines||[];"+ "var JSCompiler_lcov_executedLines=JSCompiler_lcov_executedLines||[];"+ "var JSCompiler_lcov_data_test_js=[];"+ "JSCompiler_lcov_executedLines.push(JSCompiler_lcov_data_test_js);"+ "JSCompiler_lcov_instrumentedLines.push(\"04\");"+ "JSCompiler_lcov_fileNames.push(\"test.js\");"+ "var name=1;"+ "function f(){"+ "JSCompiler_lcov_data_test_js[2]=true;"+ "var name2=2"+ "}"+ "window[\"f\"]=f;";
  Compiler compiler=new Compiler();
  CompilerOptions options=new CompilerOptions();
  options.setInstrumentForCoverage(true);
  compiler.compile(SourceFile.fromCode("extern.js","var window;"),SourceFile.fromCode("test.js",original),options);
  assertEquals(0,compiler.getWarningCount());
  assertEquals(0,compiler.getErrorCount());
  String outputSource=compiler.toSource();
  assertEquals(expected,outputSource);
}
