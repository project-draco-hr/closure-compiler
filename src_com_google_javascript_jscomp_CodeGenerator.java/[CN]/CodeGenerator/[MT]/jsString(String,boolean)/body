{
  int singleq=0, doubleq=0;
  for (int i=0; i < s.length(); i++) {
switch (s.charAt(i)) {
case '"':
      doubleq++;
    break;
case '\'':
  singleq++;
break;
}
}
String doublequote, singlequote;
char quote;
if (preferSingleQuotes ? (singleq <= doubleq) : (singleq < doubleq)) {
quote='\'';
doublequote="\"";
singlequote="\\\'";
}
 else {
quote='\"';
doublequote="\\\"";
singlequote="\'";
}
return strEscape(s,quote,doublequote,singlequote,"\\\\",outputCharsetEncoder,useSlashV,false);
}
