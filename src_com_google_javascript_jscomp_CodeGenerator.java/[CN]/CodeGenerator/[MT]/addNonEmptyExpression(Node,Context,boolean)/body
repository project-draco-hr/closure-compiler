{
  Node nodeToProcess=n;
  if (!allowNonBlockChild && n.getType() != Token.BLOCK) {
    if (validation) {
      throw new Error("Missing BLOCK child.");
    }
  }
  if (n.getType() == Token.BLOCK) {
    int count=getNonEmptyChildCount(n);
    if (count == 0) {
      cc.endStatement(true);
      return;
    }
    if (count == 1) {
      Node firstAndOnlyChild=getFirstNonEmptyChild(n);
      if (firstAndOnlyChild.getType() == Token.FUNCTION || firstAndOnlyChild.getType() == Token.DO) {
        cc.beginBlock();
        add(firstAndOnlyChild,Context.STATEMENT);
        cc.maybeLineBreak();
        cc.endBlock(context == Context.STATEMENT);
        return;
      }
 else {
        nodeToProcess=firstAndOnlyChild;
      }
    }
  }
  if (nodeToProcess.getType() == Token.EMPTY) {
    cc.endStatement(true);
  }
 else {
    add(nodeToProcess,context);
    if (nodeToProcess.getType() == Token.VAR) {
      cc.endStatement();
    }
  }
}
