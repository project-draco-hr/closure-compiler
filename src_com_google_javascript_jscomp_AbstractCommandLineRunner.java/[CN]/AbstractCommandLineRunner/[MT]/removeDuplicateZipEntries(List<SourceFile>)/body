{
  ImmutableList.Builder<JSError> errors=ImmutableList.builder();
  Map<String,SourceFile> sourceFilesByName=new HashMap<>();
  Iterator<SourceFile> fileIterator=sourceFiles.listIterator();
  while (fileIterator.hasNext()) {
    SourceFile sourceFile=fileIterator.next();
    String fullPath=sourceFile.getName();
    if (!fullPath.contains("!/")) {
      continue;
    }
    String relativePath=fullPath.split("!")[1];
    if (!sourceFilesByName.containsKey(relativePath)) {
      sourceFilesByName.put(relativePath,sourceFile);
    }
 else {
      SourceFile firstSourceFile=sourceFilesByName.get(relativePath);
      if (firstSourceFile.getCode().equals(sourceFile.getCode())) {
        errors.add(JSError.make(SourceFile.DUPLICATE_ZIP_CONTENTS,firstSourceFile.getName(),sourceFile.getName()));
        fileIterator.remove();
      }
 else {
        errors.add(JSError.make(CONFLICTING_DUPLICATE_ZIP_CONTENTS,firstSourceFile.getName(),sourceFile.getName()));
      }
    }
  }
  return errors.build();
}
