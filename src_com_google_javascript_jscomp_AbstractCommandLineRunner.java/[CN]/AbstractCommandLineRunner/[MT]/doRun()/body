{
  Compiler.setLoggingLevel(Level.parse(config.loggingLevel));
  List<JSSourceFile> externsList=createExterns();
  JSSourceFile[] externs=new JSSourceFile[externsList.size()];
  externsList.toArray(externs);
  compiler=createCompiler();
  B options=createOptions();
  JSModule[] modules=null;
  Result result;
  setRunOptions(options);
  if (inputCharset == Charsets.UTF_8) {
    options.outputCharset=Charsets.US_ASCII;
  }
 else {
    options.outputCharset=inputCharset;
  }
  if (!options.jsOutputFile.isEmpty()) {
    out=new PrintStream(options.jsOutputFile,inputCharset.name());
  }
  ((PrintStreamErrorManager)compiler.getErrorManager()).setSummaryDetailLevel(config.summaryDetailLevel);
  List<String> jsFiles=config.js;
  List<String> moduleSpecs=config.module;
  if (!moduleSpecs.isEmpty()) {
    modules=createJsModules(moduleSpecs,jsFiles);
    result=compiler.compile(externs,modules,options);
  }
 else {
    List<JSSourceFile> inputList=createSourceInputs(jsFiles);
    JSSourceFile[] inputs=new JSSourceFile[inputList.size()];
    inputList.toArray(inputs);
    result=compiler.compile(externs,inputs,options);
  }
  return processResults(result,modules,options);
}
