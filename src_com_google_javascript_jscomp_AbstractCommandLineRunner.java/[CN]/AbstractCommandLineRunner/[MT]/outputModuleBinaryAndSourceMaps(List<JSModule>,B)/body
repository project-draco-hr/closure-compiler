{
  parsedModuleWrappers=parseModuleWrappers(config.moduleWrapper,modules);
  maybeCreateDirsForPath(config.moduleOutputPathPrefix);
  Writer mapOut=null;
  if (!shouldGenerateMapPerModule(options)) {
    mapOut=fileNameToOutputWriter2(expandSourceMapPath(options,null));
  }
  for (  JSModule m : modules) {
    if (shouldGenerateMapPerModule(options)) {
      mapOut=fileNameToOutputWriter2(expandSourceMapPath(options,m));
    }
    try (Writer writer=fileNameToLegacyOutputWriter(getModuleOutputFileName(m))){
      if (options.sourceMapOutputPath != null) {
        compiler.getSourceMap().reset();
      }
      writeModuleOutput(writer,m);
      if (options.sourceMapOutputPath != null) {
        compiler.getSourceMap().appendTo(mapOut,m.getName());
      }
    }
     if (shouldGenerateMapPerModule(options) && mapOut != null) {
      mapOut.close();
      mapOut=null;
    }
  }
  if (mapOut != null) {
    mapOut.close();
  }
}
