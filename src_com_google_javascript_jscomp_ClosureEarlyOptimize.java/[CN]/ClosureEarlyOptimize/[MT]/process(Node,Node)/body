{
  List<Callback> passes=Lists.newArrayList();
  this.promiseInstanceType=compiler.getTypeRegistry().getType("goog.Promise");
  if (promiseInstanceType != null) {
    passes.add(new ReplaceThenCalls());
  }
  if (removeAbstractMethods) {
    passes.add(new FindAbstractMethods());
  }
  if (removeAssertionCalls) {
    passes.add(new FindAssertionCalls());
  }
  if (passes.isEmpty()) {
    return;
  }
  CombinedCompilerPass.traverse(compiler,root,passes);
  for (  RemovableAssignment assignment : abstractMethodAssignmentNodes) {
    assignment.remove();
  }
  for (  Node call : assertionCalls) {
    Node parent=call.getParent();
    if (parent.isExprResult()) {
      parent.getParent().removeChild(parent);
    }
 else {
      Node firstArg=call.getFirstChild().getNext();
      if (firstArg == null) {
        parent.replaceChild(call,NodeUtil.newUndefinedNode(call));
      }
 else {
        parent.replaceChild(call,firstArg.detachFromParent());
      }
    }
    compiler.reportCodeChange();
  }
}
