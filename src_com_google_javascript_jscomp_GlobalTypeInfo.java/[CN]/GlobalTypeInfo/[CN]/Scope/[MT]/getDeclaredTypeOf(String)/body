{
  Preconditions.checkArgument(!name.contains("."));
  if ("this".equals(name)) {
    if (!hasThis()) {
      return null;
    }
    return getDeclaredFunctionType().getThisType().getInstanceAsJSType();
  }
  Declaration decl=getLocalDeclaration(name,false);
  if (decl != null) {
    if (decl.getTypeOfSimpleDecl() != null) {
      Preconditions.checkState(!decl.getTypeOfSimpleDecl().isBottom(),"%s was bottom",name);
      return decl.getTypeOfSimpleDecl();
    }
 else     if (decl.getFunctionScope() != null) {
      DeclaredFunctionType scopeType=decl.getFunctionScope().getDeclaredFunctionType();
      if (scopeType != null) {
        return getCommonTypes().fromFunctionType(scopeType.toFunctionType());
      }
    }
    Preconditions.checkState(decl.getNamespace() == null);
    return null;
  }
  if (name.equals(this.name)) {
    return getCommonTypes().fromFunctionType(getDeclaredFunctionType().toFunctionType());
  }
  if (parent != null) {
    return parent.getDeclaredTypeOf(name);
  }
  return null;
}
