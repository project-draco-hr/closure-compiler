{
  Preconditions.checkArgument(fn.isFunction());
  JSDocInfo fnDoc=NodeUtil.getFunctionJSDocInfo(fn);
  ArrayList<String> formals=Lists.newArrayList();
  for (Node param=NodeUtil.getFunctionParameters(fn).getFirstChild(); param != null; param=param.getNext()) {
    formals.add(param.getQualifiedName());
  }
  FunctionTypeBuilder builder=typeParser.getFunctionType(fnDoc,fn,parentScope);
  String functionName=getFunInternalName(fn);
  if (fnDoc != null) {
    NominalType parentClass=null;
    if (fnDoc.hasBaseType()) {
      if (!fnDoc.isConstructor()) {
        warnings.add(JSError.make(fn,EXTENDS_NOT_ON_CTOR_OR_INTERF,functionName));
      }
 else {
        Node docNode=fnDoc.getBaseType().getRootNode();
        if (typeParser.hasKnownType(docNode,parentScope)) {
          parentClass=typeParser.getClassType(docNode,parentScope);
          if (parentClass == null) {
            warnings.add(JSError.make(fn,EXTENDS_NON_OBJECT,functionName,docNode.toStringTree()));
          }
        }
 else {
          warnings.add(JSError.make(fn,UNRECOGNIZED_TYPE_NAME,docNode.toStringTree()));
        }
      }
    }
    NominalType nominalType=nominaltypesByNode.get(fn);
    if (fnDoc.isConstructor()) {
      if (parentClass != null) {
        nominalType.addSuperClass(parentClass);
      }
      nominalType.addInterfaces(typeParser.getImplementedInterfaces(fnDoc,parentScope));
      builder.addClass(nominalType);
    }
 else     if (fnDoc.isInterface()) {
      if (!NodeUtil.isEmptyBlock(NodeUtil.getFunctionBody(fn))) {
        warnings.add(JSError.make(fn,INTERFACE_WITH_A_BODY));
      }
      nominalType.addInterfaces(typeParser.getExtendedInterfaces(fnDoc,parentScope));
      builder.addClass(nominalType);
    }
  }
  if (NodeUtil.isPrototypeMethod(fn)) {
    Node lhsNode=fn.getParent().getFirstChild();
    String className=NodeUtil.getPrototypeClassName(lhsNode).getQualifiedName();
    builder.addReceiverType(parentScope.getScope(className).getDeclaredType().getClassType());
  }
  return new Scope(fn,parentScope,formals,builder.buildDeclaration());
}
