{
  NTIScope methodScope=null;
  DeclaredFunctionType methodType=null;
  JSType propDeclType=null;
  JSDocInfo jsdoc=NodeUtil.getBestJSDocInfo(defSite);
  if (initializer != null && initializer.isFunction()) {
    methodScope=visitFunctionLate(initializer,rawType);
    methodType=methodScope.getDeclaredFunctionType();
  }
 else   if (jsdoc != null && jsdoc.containsFunctionDeclaration()) {
    methodType=computeFnDeclaredType(jsdoc,pname,defSite,rawType,currentScope);
  }
  if (jsdoc != null && jsdoc.hasType()) {
    propDeclType=typeParser.getDeclaredTypeOfNode(jsdoc,rawType,currentScope);
  }
 else   if (methodType != null) {
    propDeclType=commonTypes.fromFunctionType(methodType.toFunctionType());
  }
  propertyDefs.put(rawType,pname,new PropertyDef(defSite,methodType,methodScope));
  boolean isConst=isConst(defSite);
  if (propDeclType != null || isConst) {
    if (mayWarnAboutExistingProp(rawType,pname,defSite,propDeclType)) {
      return;
    }
    if (defSite.isGetProp() && propDeclType == null && isConst && !mayWarnAboutNoInit(defSite)) {
      propDeclType=inferConstTypeFromRhs(defSite);
    }
    if (!mayWarnAboutAddingPropToFinalizedNamespace(rawType,pname,jsdoc,defSite)) {
      rawType.addProtoProperty(pname,defSite,propDeclType,isConst);
      if (defSite.isGetProp()) {
        defSite.putBooleanProp(Node.ANALYZED_DURING_GTI,true);
        if (isConst) {
          defSite.putBooleanProp(Node.CONSTANT_PROPERTY_DEF,true);
        }
      }
    }
  }
 else   if (!mayWarnAboutAddingPropToFinalizedNamespace(rawType,pname,jsdoc,defSite)) {
    rawType.addUndeclaredProtoProperty(pname,defSite);
  }
}
