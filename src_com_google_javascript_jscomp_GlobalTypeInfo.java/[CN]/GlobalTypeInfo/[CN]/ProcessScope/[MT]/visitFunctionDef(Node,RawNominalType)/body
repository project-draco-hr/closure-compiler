{
  Preconditions.checkArgument(fn.isFunction());
  Scope fnScope=computeFnDeclaredType(fn,ownerType,currentScope);
  scopes.addFirst(fnScope);
  String fnName=NodeUtil.getFunctionName(fn);
  String internalName=getFunInternalName(fn);
  if (fnName != null && currentScope.isDefinedLocally(fnName)) {
    if (!fnName.contains(".")) {
      warnings.add(JSError.make(fn,VariableReferenceCheck.REDECLARED_VARIABLE,fnName));
    }
    if (internalName.startsWith(ANON_FUN_PREFIX)) {
      currentScope.addLocalFunDef(internalName,currentScope.getScope(fnName));
    }
  }
 else {
    currentScope.addLocalFunDef(internalName,fnScope);
    if (fnName != null && fnName.contains(".")) {
      currentScope.addLocalFunDef(fnName,fnScope);
    }
  }
  if (fnName != null && !fnName.contains(".")) {
    undeclaredVars.removeAll(fnName);
  }
  scopeWorkset.add(fnScope);
  return fnScope;
}
