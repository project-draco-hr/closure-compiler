{
  Scope fnScope=new Scope(fn,currentScope,formals);
  scopes.add(fnScope);
  String internalName=null;
  if (nameNode == null || !nameNode.isName()) {
    internalName=ANON_FUN_PREFIX + freshId;
    anonFunNames.put(fn,internalName);
    freshId++;
  }
 else   if (currentScope.isDefinedLocally(nameNode.getString())) {
    String fnName=nameNode.getString();
    Preconditions.checkState(!fnName.contains("."));
    warnings.add(JSError.make(fn,VariableReferenceCheck.REDECLARED_VARIABLE,fnName));
    internalName=ANON_FUN_PREFIX + freshId;
    anonFunNames.put(fn,internalName);
    freshId++;
  }
 else {
    internalName=nameNode.getString();
  }
  currentScope.addLocalFunDef(internalName,fnScope);
}
