{
  String varName=nameNode.getQualifiedName();
  JSType declType=currentScope.getDeclaredTypeOf(varName);
  if (currentScope.isLocalFunDef(varName)) {
    return inEnv;
  }
  if (NodeUtil.isNamespaceDecl(nameNode)) {
    return envPutType(inEnv,varName,declType);
  }
  Node rhs=nameNode.getFirstChild();
  TypeEnv outEnv=inEnv;
  JSType rhsType;
  if (rhs == null) {
    rhsType=JSType.UNDEFINED;
  }
 else {
    EnvTypePair pair=analyzeExprFwd(rhs,inEnv,declType != null ? declType : JSType.UNKNOWN);
    outEnv=pair.env;
    rhsType=pair.type;
  }
  if (declType != null && rhs != null) {
    if (!rhsType.isSubtypeOf(declType)) {
      warnings.add(JSError.make(rhs,MISTYPED_ASSIGN_RHS,declType.toString(),rhsType.toString()));
      rhsType=declType;
    }
 else {
      rhsType=declType.specialize(rhsType);
    }
  }
  return envPutType(outEnv,varName,rhsType);
}
