{
  Node obj=expr.getFirstChild();
  Node ctor=expr.getLastChild();
  EnvTypePair objPair, ctorPair;
  objPair=analyzeExprFwd(obj,inEnv);
  JSType objType=objPair.type;
  if (!objType.isTop() && !objType.isUnknown() && !objType.hasNonScalar()) {
    warnInvalidOperand(obj,Token.INSTANCEOF,"an object or a union type that includes an object",objPair.type);
  }
  ctorPair=analyzeExprFwd(ctor,objPair.env,commonTypes.topFunction());
  JSType ctorType=ctorPair.type;
  FunctionType ctorFunType=ctorType.getFunType();
  if (!ctorType.isUnknown() && (!ctorType.isSubtypeOf(commonTypes.topFunction()) || !ctorFunType.isQmarkFunction() && !ctorFunType.isConstructor())) {
    warnInvalidOperand(ctor,Token.INSTANCEOF,"a constructor function",ctorType);
  }
  if (ctorFunType == null || !ctorFunType.isConstructor() || (!specializedType.isTrueOrTruthy() && !specializedType.isFalseOrFalsy())) {
    ctorPair.type=JSType.BOOLEAN;
    return ctorPair;
  }
  JSType instanceType=ctorFunType.getInstanceTypeOfCtor();
  JSType instanceSpecType=specializedType.isTrueOrTruthy() ? objPair.type.specialize(instanceType) : objPair.type.removeType(instanceType);
  if (!instanceSpecType.isBottom()) {
    objPair=analyzeExprFwd(obj,inEnv,JSType.UNKNOWN,instanceSpecType);
    ctorPair=analyzeExprFwd(ctor,objPair.env,commonTypes.topFunction());
  }
  ctorPair.type=JSType.BOOLEAN;
  return ctorPair;
}
