{
  LValueResultFwd lvalResult=null;
switch (expr.getType()) {
case Token.THIS:
{
      if (currentScope.hasThis()) {
        lvalResult=new LValueResultFwd(inEnv,envGetType(inEnv,THIS_ID),currentScope.getDeclaredTypeOf(THIS_ID),new QualifiedName(THIS_ID));
      }
 else {
        mayWarnAboutGlobalThis(expr,currentScope);
        lvalResult=new LValueResultFwd(inEnv,JSType.UNKNOWN,null,null);
      }
      break;
    }
case Token.NAME:
{
    String varName=expr.getString();
    JSType varType=analyzeExprFwd(expr,inEnv).type;
    lvalResult=new LValueResultFwd(inEnv,varType,currentScope.getDeclaredTypeOf(varName),varType.hasNonScalar() ? new QualifiedName(varName) : null);
    break;
  }
case Token.GETPROP:
{
  Node obj=expr.getFirstChild();
  QualifiedName pname=new QualifiedName(expr.getLastChild().getString());
  lvalResult=analyzePropLValFwd(obj,pname,inEnv,type,insideQualifiedName);
  break;
}
case Token.GETELEM:
{
Node obj=expr.getFirstChild();
Node prop=expr.getLastChild();
if (prop.isString()) {
  QualifiedName pname=new QualifiedName(prop.getString());
  lvalResult=analyzePropLValFwd(obj,pname,inEnv,type,insideQualifiedName);
  break;
}
LValueResultFwd lvalue=analyzeLValueFwd(obj,inEnv,JSType.UNKNOWN,true);
if (isArrayType(lvalue.type)) {
  lvalResult=analyzeArrayElmLvalFwd(prop,lvalue);
  break;
}
EnvTypePair pair=analyzeExprFwd(expr,inEnv,type);
lvalResult=new LValueResultFwd(pair.env,pair.type,null,null);
break;
}
case Token.VAR:
{
Preconditions.checkState(NodeUtil.isForIn(expr.getParent()));
Node vdecl=expr.getFirstChild();
String name=vdecl.getString();
Preconditions.checkState(!vdecl.hasChildren());
return new LValueResultFwd(inEnv,JSType.STRING,null,new QualifiedName(name));
}
default :
{
Preconditions.checkState(insideQualifiedName);
EnvTypePair pair=analyzeExprFwd(expr,inEnv,type);
return new LValueResultFwd(pair.env,pair.type,null,null);
}
}
maybeSetTypeI(expr,lvalResult.type);
return lvalResult;
}
