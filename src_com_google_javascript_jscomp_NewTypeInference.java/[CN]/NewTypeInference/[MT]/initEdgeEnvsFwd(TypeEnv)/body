{
  envs.clear();
  Set<String> nonLocals=new LinkedHashSet<>();
  if (currentScope.isFunction()) {
    if (currentScope.getName() != null) {
      nonLocals.add(currentScope.getName());
    }
    nonLocals.addAll(currentScope.getOuterVars());
    nonLocals.addAll(currentScope.getFormals());
    if (currentScope.hasThis()) {
      nonLocals.add("this");
    }
    entryEnv=envPutType(entryEnv,RETVAL_ID,JSType.UNDEFINED);
  }
 else {
    nonLocals.addAll(currentScope.getExterns());
  }
  for (  String name : nonLocals) {
    JSType declType=currentScope.getDeclaredTypeOf(name);
    JSType initType=declType == null ? envGetType(entryEnv,name) : pickInitialType(declType);
    println("Adding non-local ",name," with decltype: ",declType," and inittype: ",initType);
    entryEnv=envPutType(entryEnv,name,initType);
  }
  for (  String local : currentScope.getLocals()) {
    entryEnv=envPutType(entryEnv,local,JSType.UNDEFINED);
  }
  for (  String fnName : currentScope.getLocalFunDefs()) {
    JSType summaryType=getSummaryOfLocalFunDef(fnName);
    FunctionType fnType=summaryType.getFunType();
    if (fnType.isConstructor() || fnType.isInterfaceDefinition()) {
      summaryType=fnType.createConstructorObject(commonTypes.getFunctionType());
    }
 else {
      summaryType=summaryType.withProperty(new QualifiedName("prototype"),JSType.TOP_OBJECT);
    }
    entryEnv=envPutType(entryEnv,fnName,summaryType);
  }
  println("Keeping env: ",entryEnv);
  setOutEnv(cfg.getEntry(),entryEnv);
}
