{
  Token.Kind exprKind=expr.getType();
  Node lhs=expr.getFirstChild();
  Node rhs=expr.getLastChild();
  if ((specializedType.isTrueOrTruthy() && exprKind == Token.AND) || (specializedType.isFalseOrFalsy() && exprKind == Token.OR)) {
    EnvTypePair lhsPair=analyzeExprFwd(lhs,inEnv,JSType.UNKNOWN,specializedType);
    EnvTypePair rhsPair=analyzeExprFwd(rhs,lhsPair.env,JSType.UNKNOWN,specializedType);
    return rhsPair;
  }
 else   if ((specializedType.isFalseOrFalsy() && exprKind == Token.AND) || (specializedType.isTrueOrTruthy() && exprKind == Token.OR)) {
    EnvTypePair shortCircuitPair=analyzeExprFwd(lhs,inEnv,JSType.UNKNOWN,specializedType);
    EnvTypePair lhsPair=analyzeExprFwd(lhs,inEnv,JSType.UNKNOWN,specializedType.negate());
    EnvTypePair rhsPair=analyzeExprFwd(rhs,lhsPair.env,JSType.UNKNOWN,specializedType);
    JSType lhsUnspecializedType=JSType.join(shortCircuitPair.type,lhsPair.type);
    return combineLhsAndRhsForLogicalOps(exprKind,lhsUnspecializedType,shortCircuitPair,rhsPair);
  }
 else {
    JSType stopAfterLhsType=exprKind == Token.AND ? JSType.FALSY : JSType.TRUTHY;
    EnvTypePair shortCircuitPair=analyzeExprFwd(lhs,inEnv,JSType.UNKNOWN,stopAfterLhsType);
    EnvTypePair lhsPair=analyzeExprFwd(lhs,inEnv,JSType.UNKNOWN,stopAfterLhsType.negate());
    EnvTypePair rhsPair=analyzeExprFwd(rhs,lhsPair.env,requiredType,specializedType);
    JSType lhsUnspecializedType=JSType.join(shortCircuitPair.type,lhsPair.type);
    return combineLhsAndRhsForLogicalOps(exprKind,lhsUnspecializedType,shortCircuitPair,rhsPair);
  }
}
