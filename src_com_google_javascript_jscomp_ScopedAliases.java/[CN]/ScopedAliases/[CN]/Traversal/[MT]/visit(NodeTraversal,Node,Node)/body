{
  if (isCallToScopeMethod(n)) {
    if (preprocessorSymbolTable != null) {
      preprocessorSymbolTable.addReference(n.getFirstChild());
    }
    if (!NodeUtil.isExpressionNode(parent)) {
      report(t,n,GOOG_SCOPE_USED_IMPROPERLY);
    }
    if (n.getChildCount() != 2) {
      report(t,n,GOOG_SCOPE_HAS_BAD_PARAMETERS);
    }
 else {
      Node anonymousFnNode=n.getChildAtIndex(1);
      if (!NodeUtil.isFunction(anonymousFnNode) || NodeUtil.getFunctionName(anonymousFnNode) != null || NodeUtil.getFunctionParameters(anonymousFnNode).hasChildren()) {
        report(t,anonymousFnNode,GOOG_SCOPE_HAS_BAD_PARAMETERS);
      }
 else {
        scopeCalls.add(n);
      }
    }
  }
  if (t.getScopeDepth() == 2) {
    int type=n.getType();
    if (type == Token.NAME && parent.getType() == Token.VAR) {
      if (n.hasChildren() && n.getFirstChild().isQualifiedName()) {
        String name=n.getString();
        Var aliasVar=t.getScope().getVar(name);
        aliases.put(name,aliasVar);
        aliasDefinitions.add(n);
        String qualifiedName=aliasVar.getInitialValue().getQualifiedName();
        transformation.addAlias(name,qualifiedName);
        return;
      }
 else {
        report(t,n,GOOG_SCOPE_NON_ALIAS_LOCAL,n.getString());
      }
    }
    if (type == Token.NAME && NodeUtil.isAssignmentOp(parent) && n == parent.getFirstChild()) {
      report(t,n,GOOG_SCOPE_ALIAS_REDEFINED,n.getString());
    }
    if (type == Token.RETURN) {
      report(t,n,GOOG_SCOPE_USES_RETURN);
    }
 else     if (type == Token.THIS) {
      report(t,n,GOOG_SCOPE_REFERENCES_THIS);
    }
 else     if (type == Token.THROW) {
      report(t,n,GOOG_SCOPE_USES_THROW);
    }
  }
  if (t.getScopeDepth() >= 2) {
    if (n.getType() == Token.NAME) {
      String name=n.getString();
      Var aliasVar=aliases.get(name);
      if (aliasVar != null && t.getScope().getVar(name) == aliasVar) {
        Node aliasedNode=aliasVar.getInitialValue();
        aliasUsages.add(new AliasedNode(n,aliasedNode));
      }
    }
    JSDocInfo info=n.getJSDocInfo();
    if (info != null) {
      for (      Node node : info.getTypeNodes()) {
        fixTypeNode(node);
      }
    }
  }
}
