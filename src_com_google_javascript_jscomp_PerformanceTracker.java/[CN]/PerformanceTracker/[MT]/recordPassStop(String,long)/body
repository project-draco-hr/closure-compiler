{
  Preconditions.checkState(summaryCopy == null);
  Stats logStats=currentPass.pop();
  Preconditions.checkState(passName.equals(logStats.pass));
  if (passName.equals(Compiler.PARSING_PASS_NAME) && trackSize) {
    CodeSizeEstimatePrinter estimatePrinter=new CodeSizeEstimatePrinter();
    CodeGenerator.forCostEstimation(estimatePrinter).add(jsRoot);
    initCodeSize=codeSize=estimatePrinter.calcSize();
    if (this.trackGzSize) {
      initGzCodeSize=gzCodeSize=estimatePrinter.calcZippedSize();
    }
  }
  log.add(logStats);
  Stats summaryStats=summary.get(passName);
  if (summaryStats == null) {
    summaryStats=new Stats(passName,logStats.isOneTime);
    summary.put(passName,summaryStats);
  }
  logStats.runtime=runtime;
  logStats.runs=1;
  summaryStats.runtime+=runtime;
  summaryStats.runs+=1;
  if (codeChange.hasCodeChanged()) {
    logStats.changes=1;
    summaryStats.changes+=1;
  }
  if (codeChange.hasCodeChanged() && trackSize) {
    int newSize=0;
    CodeSizeEstimatePrinter estimatePrinter=new CodeSizeEstimatePrinter();
    CodeGenerator.forCostEstimation(estimatePrinter).add(jsRoot);
    if (trackSize) {
      newSize=estimatePrinter.calcSize();
      logStats.diff=codeSize - newSize;
      summaryStats.diff+=logStats.diff;
      codeSize=summaryStats.size=logStats.size=newSize;
    }
    if (trackGzSize) {
      newSize=estimatePrinter.calcZippedSize();
      logStats.gzDiff=gzCodeSize - newSize;
      summaryStats.gzDiff+=logStats.gzDiff;
      gzCodeSize=summaryStats.gzSize=logStats.gzSize=newSize;
    }
  }
}
