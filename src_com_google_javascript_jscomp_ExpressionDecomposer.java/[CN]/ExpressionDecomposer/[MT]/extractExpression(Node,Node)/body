{
  Node parent=expr.getParent();
  boolean isLhsOfAssignOp=NodeUtil.isAssignmentOp(parent) && !NodeUtil.isAssign(parent) && parent.getFirstChild() == expr;
  Node firstExtractedNode=null;
  if (isLhsOfAssignOp && NodeUtil.isGet(expr)) {
    for (    Node n : expr.children()) {
      if (n.getType() != Token.STRING && !isConstantName(n,knownConstants)) {
        Node extractedNode=extractExpression(n,injectionPoint);
        if (firstExtractedNode == null) {
          firstExtractedNode=extractedNode;
        }
      }
    }
  }
  String tempName=getTempConstantValueName();
  Node replacementValueNode=Node.newString(Token.NAME,tempName);
  Node tempNameValue;
  if (isLhsOfAssignOp) {
    Preconditions.checkState(NodeUtil.isName(expr) || NodeUtil.isGet(expr));
    Node opNode=new Node(NodeUtil.getOpFromAssignmentOp(parent)).copyInformationFrom(parent);
    Node rightOperand=parent.getLastChild();
    parent.setType(Token.ASSIGN);
    parent.replaceChild(rightOperand,opNode);
    opNode.addChildToFront(replacementValueNode);
    opNode.addChildToBack(rightOperand);
    tempNameValue=expr.cloneTree();
  }
 else {
    parent.replaceChild(expr,replacementValueNode);
    tempNameValue=expr;
  }
  Node tempNameNode=Node.newString(Token.NAME,tempName);
  tempNameNode.addChildToBack(tempNameValue);
  Node tempVarNode=new Node(Token.VAR,tempNameNode);
  Node injectionPointParent=injectionPoint.getParent();
  injectionPointParent.addChildBefore(tempVarNode,injectionPoint);
  if (firstExtractedNode == null) {
    firstExtractedNode=tempVarNode;
  }
  return firstExtractedNode;
}
