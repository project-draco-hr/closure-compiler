{
  ImmutableMap.Builder<String,JSType> builder=ImmutableMap.builder();
  if (!typeMap.isEmpty()) {
    Preconditions.checkState(typeMap.keySet().containsAll(newTypeMap.keySet()));
    for (    String oldKey : typeMap.keySet()) {
      builder.put(oldKey,typeMap.get(oldKey).substituteGenerics(newTypeMap));
    }
  }
 else {
    for (    String newKey : newTypeMap.keySet()) {
      if (!typeMap.containsKey(newKey) && rawType.templateVars.contains(newKey)) {
        builder.put(newKey,newTypeMap.get(newKey));
      }
    }
  }
  return new NominalType(builder.build(),this.rawType);
}
