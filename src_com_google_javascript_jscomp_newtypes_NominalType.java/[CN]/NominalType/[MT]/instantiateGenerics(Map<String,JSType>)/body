{
  if (newTypeMap.isEmpty()) {
    return this;
  }
  if (!this.rawType.isGeneric()) {
    return this.rawType.wrappedAsNominal;
  }
  ImmutableMap.Builder<String,JSType> builder=ImmutableMap.builder();
  ImmutableMap<String,JSType> resultMap;
  if (!typeMap.isEmpty()) {
    for (    String oldKey : typeMap.keySet()) {
      builder.put(oldKey,typeMap.get(oldKey).substituteGenerics(newTypeMap));
    }
    resultMap=builder.build();
  }
 else {
    for (    String newKey : rawType.typeParameters) {
      if (newTypeMap.containsKey(newKey)) {
        builder.put(newKey,newTypeMap.get(newKey));
      }
    }
    resultMap=builder.build();
    if (resultMap.isEmpty()) {
      return this;
    }
    if (resultMap.size() < rawType.typeParameters.size()) {
      return this;
    }
  }
  return new NominalType(resultMap,this.rawType);
}
