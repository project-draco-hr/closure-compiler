{
  if (newTypeMap.isEmpty()) {
    return this;
  }
  if (!this.rawType.isGeneric()) {
    return this.rawType.wrappedAsNominal;
  }
  ImmutableMap.Builder<String,JSType> builder=ImmutableMap.builder();
  if (!typeMap.isEmpty()) {
    for (    String oldKey : typeMap.keySet()) {
      builder.put(oldKey,typeMap.get(oldKey).substituteGenerics(newTypeMap));
    }
  }
 else {
    for (    String newKey : rawType.typeParameters) {
      if (newTypeMap.containsKey(newKey)) {
        builder.put(newKey,newTypeMap.get(newKey));
      }
    }
  }
  return new NominalType(builder.build(),this.rawType);
}
