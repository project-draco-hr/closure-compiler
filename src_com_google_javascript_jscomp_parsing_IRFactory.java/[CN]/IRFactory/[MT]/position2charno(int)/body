{
  int newlineIndex=Collections.binarySearch(newlines,position);
  int lineIndex=-1;
  if (newlineIndex >= 0) {
    lineIndex=newlines.get(newlineIndex);
  }
 else   if (newlineIndex <= -2) {
    lineIndex=newlines.get(-newlineIndex - 2);
  }
  if (lineIndex == -1) {
    return position;
  }
 else {
    return position - lineIndex - 1;
  }
}
