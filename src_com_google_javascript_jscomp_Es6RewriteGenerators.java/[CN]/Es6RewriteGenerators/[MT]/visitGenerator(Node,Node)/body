{
  Node genBlock=compiler.parseSyntheticCode(Joiner.on('\n').join("{","  var " + GENERATOR_STATE + " = "+ generatorCaseCount+ ";","  return {","    " + ITER_KEY + ": function() { return this; },","    next: function(" + GENERATOR_NEXT_ARG + ") {","      while (1) switch (" + GENERATOR_STATE + ") {","        case " + generatorCaseCount + ":","        default:","          return {value: undefined, done: true};","      }","    }","  }","}")).removeFirstChild();
  generatorCaseCount++;
  originalGeneratorBody=n.getLastChild();
  n.replaceChild(originalGeneratorBody,genBlock);
  n.setIsGeneratorFunction(false);
  JSDocInfoBuilder builder;
  if (n.getJSDocInfo() == null) {
    builder=new JSDocInfoBuilder(true);
  }
 else {
    builder=JSDocInfoBuilder.copyFrom(n.getJSDocInfo());
  }
  builder.recordSuppressions(ImmutableSet.of("uselessCode"));
  JSDocInfo info=builder.build(n);
  n.setJSDocInfo(info);
  originalGeneratorBody.addChildToBack(IR.exprResult(IR.assign(IR.name(GENERATOR_STATE),IR.number(-1))));
  enclosingBlock=getUnique(genBlock,Token.CASE).getLastChild();
  hoistRoot=getUnique(genBlock,Token.VAR);
  if (NodeUtil.isNameReferenced(originalGeneratorBody,GENERATOR_ARGUMENTS)) {
    hoistRoot.getParent().addChildAfter(IR.var(IR.name(GENERATOR_ARGUMENTS),IR.name("arguments")),hoistRoot);
  }
  if (NodeUtil.isNameReferenced(originalGeneratorBody,GENERATOR_THIS)) {
    hoistRoot.getParent().addChildAfter(IR.var(IR.name(GENERATOR_THIS),IR.thisNode()),hoistRoot);
  }
  while (originalGeneratorBody.hasChildren()) {
    currentStatement=originalGeneratorBody.removeFirstChild();
    boolean advanceCase=translateStatementInOriginalBody();
    if (advanceCase) {
      int caseNumber;
      if (currentStatement.isGeneratorMarker()) {
        caseNumber=(int)currentStatement.getDouble();
      }
 else {
        caseNumber=generatorCaseCount;
        generatorCaseCount++;
      }
      Node newCase=IR.caseNode(IR.number(caseNumber),IR.block());
      Node oldCase=enclosingBlock.getParent();
      oldCase.getParent().addChildAfter(newCase,oldCase);
      enclosingBlock=newCase.getLastChild();
    }
  }
  parent.useSourceInfoIfMissingFromForTree(parent);
  compiler.reportCodeChange();
}
