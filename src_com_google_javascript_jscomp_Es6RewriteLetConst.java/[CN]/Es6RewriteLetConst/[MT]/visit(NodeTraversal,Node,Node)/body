{
  if (!n.isLet() && !n.isConst() && !NodeUtil.isBlockScopedFunctionDeclaration(n)) {
    return;
  }
  Scope scope=t.getScope();
  Node nameNode=n.getFirstChild();
  if (!n.isFunction() && !nameNode.hasChildren() && (parent == null || !NodeUtil.isEnhancedFor(parent))) {
    nameNode.addChildToFront(IR.name("undefined").useSourceInfoIfMissingFrom(nameNode));
  }
  String oldName=nameNode.getString();
  if (n.isLet() || n.isConst()) {
    blockScopedDeclarations.add(n);
  }
  Scope hoistScope=scope.getClosestHoistScope();
  boolean doRename=false;
  if (scope != hoistScope) {
    doRename=hoistScope.isDeclared(oldName,true);
    String newName=doRename ? oldName + "$" + compiler.getUniqueNameIdSupplier().get() : oldName;
    Var oldVar=scope.getVar(oldName);
    scope.undeclare(oldVar);
    hoistScope.declare(newName,nameNode,null,oldVar.input);
    if (doRename) {
      nameNode.setString(newName);
      Node scopeRoot=scope.getRootNode();
      if (!renameMap.containsKey(scopeRoot)) {
        renameMap.put(scopeRoot,new HashMap<String,String>());
      }
      renameMap.get(scopeRoot).put(oldName,newName);
    }
  }
  if (doRename) {
    t.getCompiler().reportCodeChange();
  }
}
