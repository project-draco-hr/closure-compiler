{
  NodeTraversal.traverseRoots(compiler,Lists.newArrayList(externs,root),new CollectUndeclaredNames());
  NodeTraversal.traverseRoots(compiler,Lists.newArrayList(externs,root),this);
  NodeTraversal.traverseRoots(compiler,Lists.newArrayList(externs,root),new RenameReferences());
  LoopClosureTransformer transformer=new LoopClosureTransformer();
  NodeTraversal.traverseRoots(compiler,Lists.newArrayList(externs,root),transformer);
  transformer.transformLoopClosure();
  if (!blockScopedDeclarations.isEmpty()) {
    for (    Node n : blockScopedDeclarations) {
      n.setType(Token.VAR);
    }
    compiler.reportCodeChange();
  }
  NodeTraversal.traverseRoots(compiler,Lists.newArrayList(externs,root),new RewriteBlockScopedFunctionDeclaration());
}
