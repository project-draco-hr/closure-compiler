{
  SourceExcerptProvider source=getSource();
  String sourceExcerpt=source == null ? null : excerpt.get(source,error.sourceName,error.lineNumber,excerptFormatter);
  StringBuilder firstLine=new StringBuilder();
  if (error.sourceName != null) {
    firstLine.append(error.sourceName);
    if (error.lineNumber > 0) {
      firstLine.append(':');
      firstLine.append(error.lineNumber);
    }
    firstLine.append(": ");
  }
  firstLine.append(getLevelName(warning ? CheckLevel.WARNING : CheckLevel.ERROR));
  firstLine.append(" - ");
  firstLine.append(error.description);
  StringBuilder b=new StringBuilder(maybeEmbolden(firstLine.toString()));
  b.append('\n');
  if (sourceExcerpt != null) {
    b.append(sourceExcerpt);
    b.append('\n');
    int charno=error.getCharno();
    if (excerpt.equals(LINE) && 0 <= charno && charno <= sourceExcerpt.length()) {
      for (int i=0; i < charno; i++) {
        char c=sourceExcerpt.charAt(i);
        if (Character.isWhitespace(c)) {
          b.append(c);
        }
 else {
          b.append(' ');
        }
      }
      b.append("^\n");
    }
  }
  return b.toString();
}
