{
  Node legacyNamespaceNode=call.getLastChild();
  Node statementNode=NodeUtil.getEnclosingStatement(call);
  String legacyNamespace=legacyNamespaceNode.getString();
  boolean targetIsNonLegacyGoogModule=rewriteState.containsModule(legacyNamespace) && !rewriteState.isLegacyModule(legacyNamespace);
  boolean targetIsGoogModuleGetted=currentScript.googModuleGettedNamespaces.contains(legacyNamespaceNode.getString());
  boolean importHasAlias=currentScript.legacyNamespacesByAlias.containsValue(legacyNamespace);
  boolean isDestructuring=statementNode.getFirstChild().isDestructuringLhs();
  boolean immediatePropertyAccess=call.getParent().isGetProp() && call.getGrandparent().isName() && NodeUtil.isNameDeclaration(call.getGrandparent().getParent());
  if (currentScript.isModule || (targetIsNonLegacyGoogModule && targetIsGoogModuleGetted)) {
    if (isDestructuring) {
      String exportedNamespace=rewriteState.getExportedNamespace(legacyNamespace);
      Node replacementNamespaceName=NodeUtil.newQName(compiler,exportedNamespace);
      replacementNamespaceName.putProp(Node.ORIGINALNAME_PROP,legacyNamespace);
      replacementNamespaceName.putBooleanProp(Node.GOOG_MODULE_REQUIRE,true);
      replacementNamespaceName.srcrefTree(call);
      call.getParent().replaceChild(call,replacementNamespaceName);
      markConst(statementNode);
    }
 else     if (targetIsNonLegacyGoogModule) {
      if (immediatePropertyAccess || !isTopLevel(t,statementNode,ScopeType.EXEC_CONTEXT)) {
        Node binaryNamespaceName=IR.name(rewriteState.getBinaryNamespace(legacyNamespace));
        binaryNamespaceName.putProp(Node.ORIGINALNAME_PROP,legacyNamespace);
        call.getParent().replaceChild(call,binaryNamespaceName);
      }
 else       if (importHasAlias || !rewriteState.isLegacyModule(legacyNamespace)) {
        statementNode.detachFromParent();
      }
    }
 else {
      if (immediatePropertyAccess) {
        Node legacyNamespaceName=NodeUtil.newQName(compiler,legacyNamespace);
        legacyNamespaceName.srcrefTree(call);
        call.getParent().replaceChild(call,legacyNamespaceName);
        Node callStatement=IR.exprResult(call);
        callStatement.srcref(call);
        statementNode.getParent().addChildBefore(callStatement,statementNode);
        markConst(statementNode);
      }
 else {
        call.detachFromParent();
        statementNode.getParent().replaceChild(statementNode,IR.exprResult(call));
      }
    }
    if (targetIsNonLegacyGoogModule) {
      Node callee=call.getFirstChild();
      Node arg=callee.getNext();
      maybeAddToSymbolTable(callee);
      maybeAddToSymbolTable(createNamespaceNode(arg));
    }
    compiler.reportCodeChange();
  }
}
