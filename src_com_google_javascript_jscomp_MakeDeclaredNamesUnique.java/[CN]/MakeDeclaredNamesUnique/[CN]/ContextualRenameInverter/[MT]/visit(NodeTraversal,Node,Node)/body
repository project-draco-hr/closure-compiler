{
  if (node.getType() == Token.NAME) {
    String oldName=node.getString();
    if (oldName.indexOf(ContextualRenamer.UNIQUE_ID_SEPARATOR) != -1) {
      Scope scope=t.getScope();
      Var var=t.getScope().getVar(oldName);
      if (var == null || var.isGlobal()) {
        return;
      }
      if (nameMap.containsKey(var)) {
        node.setString(nameMap.get(var));
      }
 else {
        String newName=oldName.substring(0,oldName.lastIndexOf(ContextualRenamer.UNIQUE_ID_SEPARATOR));
        String suffix=oldName.substring(oldName.lastIndexOf(ContextualRenamer.UNIQUE_ID_SEPARATOR) + ContextualRenamer.UNIQUE_ID_SEPARATOR.length(),oldName.length());
        boolean recurseScopes=false;
        if (!suffix.matches("\\d+")) {
          recurseScopes=true;
        }
        if (var.scope.isDeclared(newName,recurseScopes) || !TokenStream.isJSIdentifier(newName)) {
          newName=oldName;
        }
 else {
          var.scope.declare(newName,var.nameNode,null,null);
          Node parentNode=var.getParentNode();
          if (parentNode.getType() == Token.FUNCTION && parentNode == var.scope.getRootNode()) {
            var.getNameNode().setString(newName);
          }
          node.setString(newName);
          compiler.reportCodeChange();
        }
        nameMap.put(var,newName);
      }
    }
  }
}
