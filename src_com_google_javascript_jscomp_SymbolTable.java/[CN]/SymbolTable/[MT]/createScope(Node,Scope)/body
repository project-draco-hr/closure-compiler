{
  Preconditions.checkArgument((n.getType() == Token.BLOCK && n.getParent() == null) || n.getType() == Token.FUNCTION,"May only create scopes for the global node and functions");
  ensureCacheInitialized();
  if (!cache.scopes.containsKey(n)) {
    cache.scopes.put(n,scopeCreator.createScope(n,parent));
  }
  return cache.scopes.get(n);
}
