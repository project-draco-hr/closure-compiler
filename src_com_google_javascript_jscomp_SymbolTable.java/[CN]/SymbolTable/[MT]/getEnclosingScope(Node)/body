{
  Node current=n.getParent();
  if (n.getType() == Token.NAME && n.getParent().getType() == Token.FUNCTION) {
    current=current.getParent();
  }
  for (; current != null; current=current.getParent()) {
    if (scopes.containsKey(current)) {
      return scopes.get(current);
    }
  }
  return null;
}
