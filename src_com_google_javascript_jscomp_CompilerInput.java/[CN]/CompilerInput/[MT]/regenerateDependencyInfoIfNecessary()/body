{
  if (!(ast instanceof JsAst)) {
    Preconditions.checkNotNull(compiler,"Expected setCompiler to be called first");
    DepsFinder finder=new DepsFinder();
    Node root=getAstRoot(compiler);
    if (root == null) {
      return;
    }
    finder.visitTree(getAstRoot(compiler));
    isModuleFile=finder.isModuleFile;
    provides.addAll(finder.provides);
    requires.addAll(finder.requires);
  }
 else {
    if (!generatedDependencyInfoFromSource) {
      DependencyInfo info=(new JsFileParser(compiler.getErrorManager())).setIncludeGoogBase(true).parseFile(getName(),getName(),getCode());
      isModuleFile=info.isModule();
      provides.addAll(info.getProvides());
      requires.addAll(info.getRequires());
      generatedDependencyInfoFromSource=true;
    }
  }
}
