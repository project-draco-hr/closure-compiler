{
  final Set<Node> references=Sets.newHashSet();
  NodeTraversal.traverse(compiler,root,new AbstractShallowCallback(){
    @Override public void visit(    NodeTraversal t,    Node n,    Node parent){
      if (NodeUtil.isGet(n) || (NodeUtil.isName(n) && !NodeUtil.isFunction(parent))) {
        references.add(n);
      }
    }
  }
);
  return references;
}
