{
  int type=n.getType();
  if (type == Token.SCRIPT) {
    inputId=n.getInputId();
    sourceName=getSourceName(n);
  }
  curNode=n;
  if (!callback.shouldTraverse(this,n,parent)) {
    return;
  }
  if (type == Token.FUNCTION) {
    traverseFunction(n,parent);
  }
 else   if (NodeUtil.createsBlockScope(n) && scopeCreator.hasBlockScope()) {
    traverseBlockScope(n);
  }
 else {
    for (Node child=n.getFirstChild(); child != null; ) {
      Node next=child.getNext();
      traverseBranch(child,n);
      child=next;
    }
  }
  curNode=n;
  callback.visit(this,n,parent);
}
