{
  Node n=s.getRootNode();
  if (n.isFunction()) {
    if (inputId == null) {
      inputId=NodeUtil.getInputId(n);
    }
    sourceName=getSourceName(n);
    curNode=n;
    pushScope(s);
    Node args=n.getFirstChild().getNext();
    Node body=args.getNext();
    traverseBranch(args,n);
    traverseBranch(body,n);
    popScope();
  }
 else   if (n.isBlock()) {
    if (inputId == null) {
      inputId=NodeUtil.getInputId(n);
    }
    sourceName=getSourceName(n);
    curNode=n;
    pushScope(s);
    traverseBranch(n,n.getParent());
    popScope();
  }
 else {
    Preconditions.checkState(s.isGlobal(),"Expected global scope. Got:",s);
    traverseWithScope(n,s);
  }
}
