{
  for (Node child=n.getFirstChild(); child != null; child=child.getNext()) {
    if (child.getType() == Token.IF) {
      Node cond=child.getFirstChild();
      Node thenBranch=cond.getNext();
      Node elseBranch=thenBranch.getNext();
      Node nextNode=child.getNext();
      if (nextNode != null && elseBranch == null && isReturnBlock(thenBranch) && isReturnExpression(nextNode)) {
        Node thenExpr=null;
        if (isReturnExpressBlock(thenBranch)) {
          thenExpr=getBlockReturnExpression(thenBranch);
          thenExpr.detachFromParent();
        }
 else {
          thenExpr=NodeUtil.newUndefinedNode(child);
        }
        Node elseExpr=nextNode.getFirstChild();
        cond.detachFromParent();
        elseExpr.detachFromParent();
        Node hookNode=new Node(Token.HOOK,cond,thenExpr,elseExpr).copyInformationFrom(child);
        Node returnNode=new Node(Token.RETURN,hookNode);
        n.replaceChild(child,returnNode);
        n.removeChild(nextNode);
        reportCodeChange();
      }
 else       if (elseBranch != null && statementMustExitParent(thenBranch)) {
        child.removeChild(elseBranch);
        n.addChildAfter(elseBranch,child);
        reportCodeChange();
      }
    }
  }
  return n;
}
