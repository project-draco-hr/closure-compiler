{
  for (Node child=n.getFirstChild(); child != null; child=child.getNext()) {
    if (child.isIf()) {
      Node cond=child.getFirstChild();
      Node thenBranch=cond.getNext();
      Node elseBranch=thenBranch.getNext();
      Node nextNode=child.getNext();
      if (nextNode != null && elseBranch == null && isReturnBlock(thenBranch) && nextNode.isIf()) {
        Node nextCond=nextNode.getFirstChild();
        Node nextThen=nextCond.getNext();
        Node nextElse=nextThen.getNext();
        if (thenBranch.isEquivalentToTyped(nextThen)) {
          child.detachFromParent();
          child.detachChildren();
          Node newCond=new Node(Token.OR,cond);
          nextNode.replaceChild(nextCond,newCond);
          newCond.addChildToBack(nextCond);
          reportCodeChange();
        }
 else         if (nextElse != null && thenBranch.isEquivalentToTyped(nextElse)) {
          child.detachFromParent();
          child.detachChildren();
          Node newCond=new Node(Token.AND,new Node(Token.NOT,cond).copyInformationFrom(cond));
          nextNode.replaceChild(nextCond,newCond);
          newCond.addChildToBack(nextCond);
          reportCodeChange();
        }
      }
 else       if (nextNode != null && elseBranch == null && isReturnBlock(thenBranch) && isReturnExpression(nextNode)) {
        Node thenExpr=null;
        if (isReturnExpressBlock(thenBranch)) {
          thenExpr=getBlockReturnExpression(thenBranch);
          thenExpr.detachFromParent();
        }
 else {
          thenExpr=NodeUtil.newUndefinedNode(child);
        }
        Node elseExpr=nextNode.getFirstChild();
        cond.detachFromParent();
        elseExpr.detachFromParent();
        Node hookNode=new Node(Token.HOOK,cond,thenExpr,elseExpr).copyInformationFrom(child);
        Node returnNode=new Node(Token.RETURN,hookNode);
        n.replaceChild(child,returnNode);
        n.removeChild(nextNode);
        reportCodeChange();
      }
 else       if (elseBranch != null && statementMustExitParent(thenBranch)) {
        child.removeChild(elseBranch);
        n.addChildAfter(elseBranch,child);
        reportCodeChange();
      }
    }
  }
  return n;
}
