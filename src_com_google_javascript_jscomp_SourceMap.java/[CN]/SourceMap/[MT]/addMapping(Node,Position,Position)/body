{
  String sourceFile=(String)node.getProp(Node.SOURCEFILE_PROP);
  if (sourceFile == null || node.getLineno() < 0) {
    return;
  }
  Mapping mapping=new Mapping();
  mapping.sourceFile=sourceFile;
  mapping.originalPosition=new Position(node.getLineno(),node.getCharno());
  String originalName=(String)node.getProp(Node.ORIGINALNAME_PROP);
  if (originalName != null) {
    mapping.originalName=originalName;
  }
  if (offsetPosition.getLineNumber() == 0 && offsetPosition.getCharacterIndex() == 0) {
    mapping.startPosition=startPosition;
    mapping.endPosition=endPosition;
  }
 else {
    int offsetLine=offsetPosition.getLineNumber();
    int startOffsetPosition=offsetPosition.getCharacterIndex();
    int endOffsetPosition=offsetPosition.getCharacterIndex();
    if (startPosition.getLineNumber() > 0) {
      startOffsetPosition=0;
    }
    if (endPosition.getLineNumber() > 0) {
      endOffsetPosition=0;
    }
    mapping.startPosition=new Position(startPosition.getLineNumber() + offsetLine,startPosition.getCharacterIndex() + startOffsetPosition);
    mapping.endPosition=new Position(endPosition.getLineNumber() + offsetLine,endPosition.getCharacterIndex() + endOffsetPosition);
  }
  if (lastMapping != null) {
    int lastLine=lastMapping.startPosition.getLineNumber();
    int lastColumn=lastMapping.startPosition.getCharacterIndex();
    int nextLine=mapping.startPosition.getLineNumber();
    int nextColumn=mapping.startPosition.getCharacterIndex();
    Preconditions.checkState(nextLine > lastLine || (nextLine == lastLine && nextColumn >= lastColumn),"Incorrect source mappings order, previous : (%s,%s)\n" + "new : (%s,%s)\nnode : %s",lastLine,lastColumn,nextLine,nextColumn,node);
  }
  lastMapping=mapping;
  mappings.add(mapping);
}
